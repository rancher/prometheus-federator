--- charts-original/templates/rancher-monitoring/hardened.yaml
+++ charts/templates/rancher-monitoring/hardened.yaml
@@ -28,11 +28,17 @@
       tolerations: {{ include "linux-node-tolerations" . | nindent 8 }}
       containers:
       {{- range $_, $ns := $namespaces }}
-      - name: patch-sa-{{ $ns }}
-        image: {{ template "system_default_registry" $ }}{{ $.Values.global.kubectl.repository }}:{{ $.Values.global.kubectl.tag }}
-        imagePullPolicy: {{ $.Values.global.kubectl.pullPolicy }}
-        command: ["kubectl", "patch", "serviceaccount", "default", "-p", "{\"automountServiceAccountToken\": false}"]
-        args: ["-n", "{{ $ns }}"]
+        - name: patch-sa-{{ $ns }}
+          image: {{ template "system_default_registry" $ }}{{ $.Values.global.kubectl.repository }}:{{ $.Values.global.kubectl.tag }}
+          imagePullPolicy: {{ $.Values.global.kubectl.pullPolicy }}
+          command: ["kubectl", "patch", "serviceaccount", "default", "-p", "{\"automountServiceAccountToken\": false}"]
+          args: ["-n", "{{ $ns }}"]
+{{- if $.Values.global.kubectl.resources }}
+          resources: {{ toYaml $.Values.global.kubectl.resources | nindent 10 }}
+{{- end }}
+{{- if $.Values.global.kubectl.containerSecurityContext }}
+          securityContext: {{ toYaml $.Values.global.kubectl.containerSecurityContext | nindent 10 }}
+{{- end }}
       {{- end }}
 ---
 apiVersion: rbac.authorization.k8s.io/v1
@@ -42,11 +48,11 @@
   labels:
     app: {{ .Chart.Name }}-patch-sa
 rules:
-- apiGroups:
-  - ""
-  resources:
-  - serviceaccounts
-  verbs: ['get', 'patch']
+  - apiGroups:
+      - ""
+    resources:
+      - serviceaccounts
+    verbs: ['get', 'patch']
 ---
 apiVersion: rbac.authorization.k8s.io/v1
 kind: ClusterRoleBinding
@@ -59,9 +65,9 @@
   kind: ClusterRole
   name: {{ .Chart.Name }}-patch-sa
 subjects:
-- kind: ServiceAccount
-  name: {{ .Chart.Name }}-patch-sa
-  namespace: {{ .Release.Namespace }}
+  - kind: ServiceAccount
+    name: {{ .Chart.Name }}-patch-sa
+    namespace: {{ .Release.Namespace }}
 ---
 apiVersion: v1
 kind: ServiceAccount
@@ -70,22 +76,18 @@
   namespace: {{ .Release.Namespace }}
   labels:
     app: {{ .Chart.Name }}-patch-sa
+{{- range $_, $ns := $namespaces }}
 ---
-{{- if .Values.hardened.k3s.networkPolicy.enabled }}
 apiVersion: networking.k8s.io/v1
 kind: NetworkPolicy
 metadata:
-  name: rancher-monitoring-coredns-allow-all
-  namespace: kube-system
+  name: project-monitoring-policy
+  namespace: {{ $ns }}
 spec:
-  ingress:
-  - {}
-  egress:
-  - {}
+  podSelector: {}
+  ingress: {{- default (list dict | toYaml) (include "kube-prometheus-stack.hardened.networkPolicy.ingress" (list $ $ns)) | nindent 4 }}
+  egress: {{- $.Values.global.networkPolicy.egress | toYaml | nindent 4 }}
   policyTypes:
-  - Ingress
-  - Egress 
-  podSelector:
-    matchLabels:
-      k8s-app: kube-dns
+    - Ingress
+    - Egress
 {{- end }}
\ No newline at end of file
